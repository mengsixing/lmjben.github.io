<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端性能优化 | lmjben的前端日志</title>
    <meta name="description" content="欢迎访问我的前端日志">
    <link rel="icon" href="/hero.jpeg">
    
    <link rel="preload" href="/assets/css/0.styles.9a4bacdc.css" as="style"><link rel="preload" href="/assets/js/app.1485f227.js" as="script"><link rel="preload" href="/assets/js/2.691ff22b.js" as="script"><link rel="preload" href="/assets/js/33.4702ebe7.js" as="script"><link rel="prefetch" href="/assets/js/10.c5768c8e.js"><link rel="prefetch" href="/assets/js/100.b661c441.js"><link rel="prefetch" href="/assets/js/101.af64b2e7.js"><link rel="prefetch" href="/assets/js/102.9685a22b.js"><link rel="prefetch" href="/assets/js/103.06934896.js"><link rel="prefetch" href="/assets/js/11.789f6f01.js"><link rel="prefetch" href="/assets/js/12.d10a2133.js"><link rel="prefetch" href="/assets/js/13.95caa5f4.js"><link rel="prefetch" href="/assets/js/14.f23b85e4.js"><link rel="prefetch" href="/assets/js/15.50e521cf.js"><link rel="prefetch" href="/assets/js/16.eade1c78.js"><link rel="prefetch" href="/assets/js/17.457414de.js"><link rel="prefetch" href="/assets/js/18.95da866d.js"><link rel="prefetch" href="/assets/js/19.25e0d9a3.js"><link rel="prefetch" href="/assets/js/20.969ddd8d.js"><link rel="prefetch" href="/assets/js/21.53060c5a.js"><link rel="prefetch" href="/assets/js/22.03225991.js"><link rel="prefetch" href="/assets/js/23.01007a64.js"><link rel="prefetch" href="/assets/js/24.08f73268.js"><link rel="prefetch" href="/assets/js/25.9a184e4e.js"><link rel="prefetch" href="/assets/js/26.34e2650b.js"><link rel="prefetch" href="/assets/js/27.cf08ef4f.js"><link rel="prefetch" href="/assets/js/28.920f2f9d.js"><link rel="prefetch" href="/assets/js/29.cb3d1110.js"><link rel="prefetch" href="/assets/js/3.6b643e28.js"><link rel="prefetch" href="/assets/js/30.b31f5ca9.js"><link rel="prefetch" href="/assets/js/31.acfc9fee.js"><link rel="prefetch" href="/assets/js/32.f9349efd.js"><link rel="prefetch" href="/assets/js/34.af560b46.js"><link rel="prefetch" href="/assets/js/35.78dbed49.js"><link rel="prefetch" href="/assets/js/36.5f055a32.js"><link rel="prefetch" href="/assets/js/37.304cb650.js"><link rel="prefetch" href="/assets/js/38.da1d9922.js"><link rel="prefetch" href="/assets/js/39.3f64418e.js"><link rel="prefetch" href="/assets/js/4.be4cf9cd.js"><link rel="prefetch" href="/assets/js/40.26308def.js"><link rel="prefetch" href="/assets/js/41.333bd606.js"><link rel="prefetch" href="/assets/js/42.22740290.js"><link rel="prefetch" href="/assets/js/43.c4708cee.js"><link rel="prefetch" href="/assets/js/44.7ba4884d.js"><link rel="prefetch" href="/assets/js/45.1819ccc5.js"><link rel="prefetch" href="/assets/js/46.0df3f25b.js"><link rel="prefetch" href="/assets/js/47.7a7b02f1.js"><link rel="prefetch" href="/assets/js/48.9bdef038.js"><link rel="prefetch" href="/assets/js/49.c62df0da.js"><link rel="prefetch" href="/assets/js/5.99f50133.js"><link rel="prefetch" href="/assets/js/50.bbc5d86e.js"><link rel="prefetch" href="/assets/js/51.c2655534.js"><link rel="prefetch" href="/assets/js/52.e73c842e.js"><link rel="prefetch" href="/assets/js/53.844a927a.js"><link rel="prefetch" href="/assets/js/54.67ecbd51.js"><link rel="prefetch" href="/assets/js/55.f342c0e4.js"><link rel="prefetch" href="/assets/js/56.5f897ad2.js"><link rel="prefetch" href="/assets/js/57.83ad9231.js"><link rel="prefetch" href="/assets/js/58.c0792311.js"><link rel="prefetch" href="/assets/js/59.8d6fc421.js"><link rel="prefetch" href="/assets/js/6.e33f191f.js"><link rel="prefetch" href="/assets/js/60.fc3baf04.js"><link rel="prefetch" href="/assets/js/61.150a2079.js"><link rel="prefetch" href="/assets/js/62.292f995b.js"><link rel="prefetch" href="/assets/js/63.d2c6d438.js"><link rel="prefetch" href="/assets/js/64.5ac5396d.js"><link rel="prefetch" href="/assets/js/65.74618273.js"><link rel="prefetch" href="/assets/js/66.a1d769d0.js"><link rel="prefetch" href="/assets/js/67.bf0a075a.js"><link rel="prefetch" href="/assets/js/68.40b7a59e.js"><link rel="prefetch" href="/assets/js/69.fe7a402f.js"><link rel="prefetch" href="/assets/js/7.50c60e1c.js"><link rel="prefetch" href="/assets/js/70.982f5d9f.js"><link rel="prefetch" href="/assets/js/71.15109e62.js"><link rel="prefetch" href="/assets/js/72.bd7522a7.js"><link rel="prefetch" href="/assets/js/73.78432fa4.js"><link rel="prefetch" href="/assets/js/74.20d9f627.js"><link rel="prefetch" href="/assets/js/75.4edb3527.js"><link rel="prefetch" href="/assets/js/76.bbb2c5df.js"><link rel="prefetch" href="/assets/js/77.9adccfdf.js"><link rel="prefetch" href="/assets/js/78.d88a62f5.js"><link rel="prefetch" href="/assets/js/79.510af5dc.js"><link rel="prefetch" href="/assets/js/8.3d656c71.js"><link rel="prefetch" href="/assets/js/80.2ae2fb66.js"><link rel="prefetch" href="/assets/js/81.0942fafd.js"><link rel="prefetch" href="/assets/js/82.bbcedff2.js"><link rel="prefetch" href="/assets/js/83.a4ab753b.js"><link rel="prefetch" href="/assets/js/84.f785d345.js"><link rel="prefetch" href="/assets/js/85.c71cd67c.js"><link rel="prefetch" href="/assets/js/86.d379ff51.js"><link rel="prefetch" href="/assets/js/87.3758b382.js"><link rel="prefetch" href="/assets/js/88.2772c431.js"><link rel="prefetch" href="/assets/js/89.b96bb245.js"><link rel="prefetch" href="/assets/js/9.99042667.js"><link rel="prefetch" href="/assets/js/90.cd327d46.js"><link rel="prefetch" href="/assets/js/91.7af731b0.js"><link rel="prefetch" href="/assets/js/92.bef1cc16.js"><link rel="prefetch" href="/assets/js/93.a9dc06ce.js"><link rel="prefetch" href="/assets/js/94.392fcf90.js"><link rel="prefetch" href="/assets/js/95.e080d782.js"><link rel="prefetch" href="/assets/js/96.08e57e9c.js"><link rel="prefetch" href="/assets/js/97.60f0e906.js"><link rel="prefetch" href="/assets/js/98.690d4b0c.js"><link rel="prefetch" href="/assets/js/99.abee4fbe.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9a4bacdc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">lmjben的前端日志</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">博客</a></div><div class="nav-item"><a href="/interview/" class="nav-link">面试题</a></div><div class="nav-item"><a href="/book/" class="nav-link">阅读</a></div> <a href="https://github.com/lmjben/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">博客</a></div><div class="nav-item"><a href="/interview/" class="nav-link">面试题</a></div><div class="nav-item"><a href="/book/" class="nav-link">阅读</a></div> <a href="https://github.com/lmjben/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>DevOps</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/devops-kubernetes.html" class="sidebar-link">Kubernetes 使用总结</a></li><li><a href="/blog/devops-docker.html" class="sidebar-link">Docker 使用总结</a></li><li><a href="/blog/devops-git.html" class="sidebar-link">Git 常用使用方式</a></li><li><a href="/blog/devops-dependencies.html" class="sidebar-link">Package.json 依赖管理</a></li><li><a href="/blog/devops-image.html" class="sidebar-link">合理选择图片格式</a></li><li><a href="/blog/devops-performance.html" class="active sidebar-link">前端性能优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/devops-performance.html#网络传输性能优化" class="sidebar-link">网络传输性能优化</a></li><li class="sidebar-sub-header"><a href="/blog/devops-performance.html#页面渲染性能优化" class="sidebar-link">页面渲染性能优化</a></li><li class="sidebar-sub-header"><a href="/blog/devops-performance.html#其他优化" class="sidebar-link">其他优化</a></li><li class="sidebar-sub-header"><a href="/blog/devops-performance.html#参考链接" class="sidebar-link">参考链接</a></li></ul></li><li><a href="/blog/devops-commitlint.html" class="sidebar-link">Commitlint 使用总结</a></li><li><a href="/blog/devops-test.html" class="sidebar-link">前端测试</a></li><li><a href="/blog/devops-webpack-entry.html" class="sidebar-link">Webpack 系列（三）整体流程分析</a></li><li><a href="/blog/devops-webpack-flow.html" class="sidebar-link">Webpack 系列（二）手写模块打包代码</a></li><li><a href="/blog/devops-webpack.html" class="sidebar-link">Webpack 系列（一）使用总结</a></li><li><a href="/blog/devops-cdfang-spider.html" class="sidebar-link">实战：手搭一个 React，Typescript，Koa，GraphQL 环境</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Framework</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/library-node.html" class="sidebar-link">Node.js 使用总结</a></li><li><a href="/blog/library-react.html" class="sidebar-link">React 使用总结</a></li><li><a href="/blog/libary-react-core.html" class="sidebar-link">React 核心知识</a></li><li><a href="/blog/library-react-code-1.html" class="sidebar-link">React 源码解析（一）JSX 转换</a></li><li><a href="/blog/library-react-code-2.html" class="sidebar-link">React 源码解析（二）FiberRoot 构建</a></li><li><a href="/blog/library-react-code-3.html" class="sidebar-link">React 源码解析（三）Fiber 的调度过程</a></li><li><a href="/blog/library-react-code-4.html" class="sidebar-link">React 源码解析（四）深入理解 fiber 更新过程</a></li><li><a href="/blog/library-react-ssr.html" class="sidebar-link">React 服务器端渲染</a></li><li><a href="/blog/library-react-hooks.html" class="sidebar-link">使用 React Hooks 节省 90% 的代码</a></li><li><a href="/blog/library-vue.html" class="sidebar-link">Vue 使用总结</a></li><li><a href="/blog/library-miniProgram.html" class="sidebar-link">小程序使用总结</a></li><li><a href="/blog/library-redux.html" class="sidebar-link">Redux 使用总结</a></li><li><a href="/blog/library-react-redux-code.html" class="sidebar-link">React Hooks 替代 React-Redux</a></li><li><a href="/blog/library-rxjs.html" class="sidebar-link">RxJS 基础知识总结</a></li><li><a href="/blog/library-koa.html" class="sidebar-link">Koa 源码阅读</a></li><li><a href="/blog/library-koa-diy.html" class="sidebar-link">深入 Koa 原理</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>CSS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/css.html" class="sidebar-link">CSS 使用总结</a></li><li><a href="/blog/css-next.html" class="sidebar-link">CSS NEXT 语法</a></li><li><a href="/blog/css-flex.html" class="sidebar-link">CSS Flex 布局总结</a></li><li><a href="/blog/css-useful.html" class="sidebar-link">CSS 有趣的特性</a></li><li><a href="/blog/css-devicePixelRatio.html" class="sidebar-link">CSS 设备像素比</a></li><li><a href="/blog/css-houdini-star.html" class="sidebar-link">CSS Houdini 画一片星空</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>网络协议</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/osi-http.html" class="sidebar-link">HTTP 协议总结</a></li><li><a href="/blog/osi-https.html" class="sidebar-link">HTTPS 协议总结</a></li><li><a href="/blog/osi-tcp.html" class="sidebar-link">TCP 协议总结</a></li><li><a href="/blog/osi-web-security.html" class="sidebar-link">Web 安全</a></li><li><a href="/blog/osi-web-login.html" class="sidebar-link">Web 登录鉴权</a></li><li><a href="/blog/osi-hijack.html" class="sidebar-link">流量劫持</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>运维相关</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/operation-docker-micro-service.html" class="sidebar-link">Docker 部署简单的 Web 服务</a></li><li><a href="/blog/operation-linux.html" class="sidebar-link">Linux 快捷键</a></li><li><a href="/blog/operation-linux-login.html" class="sidebar-link">Linux 免密登录配置</a></li><li><a href="/blog/operation-nginx-load-balancing.html" class="sidebar-link">Nginx 负载均衡配置</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JS 基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/js-principle.html" class="sidebar-link">JS 编译器，解释引擎</a></li><li><a href="/blog/js-promise.html" class="sidebar-link">JS 理解 Promise</a></li><li><a href="/blog/js-this.html" class="sidebar-link">JS 理解 This</a></li><li><a href="/blog/js-operator-priority.html" class="sidebar-link">JS 运算符优先级</a></li><li><a href="/blog/js-jsBridge.html" class="sidebar-link">JS Bridge 总结</a></li><li><a href="/blog/js-module.html" class="sidebar-link">JS 模块化</a></li><li><a href="/blog/js-inherit.html" class="sidebar-link">JS 实现继承</a></li><li><a href="/blog/js-event.html" class="sidebar-link">JS 事件</a></li><li><a href="/blog/js-form.html" class="sidebar-link">JS 表单基础知识</a></li><li><a href="/blog/js-html5-program.html" class="sidebar-link">JS PostMessage &amp; 拖放 API</a></li><li><a href="/blog/js-recursion.html" class="sidebar-link">JS 函数尾递归优化</a></li><li><a href="/blog/js-object-ergodic.html" class="sidebar-link">JS 对象属性的遍历</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>编程基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/base-ioc.html" class="sidebar-link">你需要知道的依赖注入</a></li><li><a href="/blog/base-functional.html" class="sidebar-link">函数式编程</a></li><li><a href="/blog/base-structure.html" class="sidebar-link">数据结构与算法</a></li><li><a href="/blog/base-structure-base-select.html" class="sidebar-link">查找算法</a></li><li><a href="/blog/base-structure-base-sort.html" class="sidebar-link">基本排序算法</a></li><li><a href="/blog/base-structure-high-algorithm.html" class="sidebar-link">高级算法</a></li><li><a href="/blog/base-structure-senior-sort.html" class="sidebar-link">高级排序算法</a></li><li><a href="/blog/base-design-pattern.html" class="sidebar-link">设计模式</a></li><li><a href="/blog/base-computer.html" class="sidebar-link">计算机组成原理</a></li><li><a href="/blog/base-technology.html" class="sidebar-link">专业术语</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>总结思考</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/2019-6.html" class="sidebar-link">我的 2019 总结（上）</a></li><li><a href="/blog/2018.html" class="sidebar-link">我的 2018 总结</a></li><li><a href="/blog/frontend.html" class="sidebar-link">我的前端知识清单</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>其它</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/other-pit.html" class="sidebar-link">记录遇到的坑</a></li><li><a href="/blog/other-tools.html" class="sidebar-link">常用工具整理</a></li><li><a href="/blog/other-vscode.html" class="sidebar-link">VSCode 常用快捷键</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="前端性能优化"><a href="#前端性能优化" class="header-anchor">#</a> 前端性能优化</h1> <p>我们先来看一下页面渲染流程图，每个阶段的用时可以在 <code>performance.timing</code> 里查询。</p> <p><img src="devops-performance-page_render.png" alt="页面渲染流程图"></p> <p>从图中我们可以看出，浏览器在得到用户请求之后，经历了下面这些阶段：重定向 → 拉取缓存 → dns 查询 → 建立 tcp 连接 → 发起请求 → 接收响应 → 处理 html 元素 → 元素加载完成。</p> <ul><li>网络传输性能优化
<ul><li>浏览器缓存</li> <li>使用 http2</li> <li>资源打包压缩
<ul><li>js 压缩</li> <li>html 压缩</li> <li>css 压缩</li></ul></li> <li>图片资源优化
<ul><li>不要在 html 里缩放图像</li> <li>使用雪碧图（css sprite）</li> <li>使用字体图标（iconfont）</li> <li>使用 webp</li></ul></li> <li>使用 cdn</li> <li>使用预加载</li></ul></li> <li>页面渲染性能优化
<ul><li>浏览器渲染过程（webkit）</li> <li>dom 渲染层与 gpu 硬件加速</li> <li>重排与重绘</li></ul></li> <li>其他优化
<ul><li>pc 端</li> <li>移动端</li> <li>前后端同构</li></ul></li></ul> <h2 id="网络传输性能优化"><a href="#网络传输性能优化" class="header-anchor">#</a> 网络传输性能优化</h2> <p>我们常将网络性能优化措施归结为三大方面：<strong>减少请求数</strong>、<strong>减小请求资源大小</strong>、<strong>提升网络传输速率</strong>。</p> <h3 id="浏览器缓存"><a href="#浏览器缓存" class="header-anchor">#</a> 浏览器缓存</h3> <p>浏览器在向服务器发起请求前，会先查询本地是否有相同的文件，如果有，就会直接拉取本地缓存，我们先看看浏览器处理缓存的策略。</p> <p><img src="devops-performance-cache.png" alt="浏览器缓存图"></p> <p>浏览器默认的缓存是放在内存中的，但内存里的缓存会因为进程的结束或者说浏览器的关闭而被清除，如果存在硬盘里就能够被长期保留下去。很多时候，我们在 network 面板中各请求的 size 项里，会看到两种不同的状态：<em>from memory cache</em> 和 <em>from disk cache</em>，前者指缓存来自内存，后者指缓存来自硬盘。而控制缓存存放位置的是我们在服务器上设置的 etag 字段。在浏览器接收到服务器响应后，会检测响应头部，如果有 etag 字段，那么浏览器就会将本次缓存写入硬盘中。</p> <h3 id="使用-http2"><a href="#使用-http2" class="header-anchor">#</a> 使用 HTTP2</h3> <p>我们都知道，在一次 http 请求中，底层会通过 tcp 建立连接。而 tcp 协议存在 3 次握手，4 次挥手阶段，这些机制保证了 tcp 的可靠性，但降低了传输效率，为了解决这个问题，我们可以使用 http2 来增加传输时候效率。</p> <p>http2 相比 http1 主要有以下几点优化：</p> <ul><li>多路复用
<ul><li>多个 http 复用一个 tcp 连接，减少 tcp 握手时间。</li></ul></li> <li>压缩头部
<ul><li>常用的头部字段保存在表里，传输时只需要传递索引值即可。</li></ul></li> <li>服务器端推送
<ul><li>服务器根据页面内容，主动把页面需要的资源传给客户端，减少请求数。</li></ul></li></ul> <h3 id="资源打包压缩"><a href="#资源打包压缩" class="header-anchor">#</a> 资源打包压缩</h3> <p>我们之前所作的浏览器缓存工作，只有在用户第二次访问我们的页面才能起到效果，如果要在用户首次打开页面就实现优良的性能，必须对资源进行优化。</p> <h4 id="压缩-js-代码"><a href="#压缩-js-代码" class="header-anchor">#</a> 压缩 JS 代码</h4> <p>在 webpack 的 production 模式中，会自动压缩 js 代码。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>optimization<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  minimizer<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">UglifyJsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      cache<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      parallel<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      sourceMap<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token comment">// set to true if you want JS source maps</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>Plugins
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="压缩-html-代码"><a href="#压缩-html-代码" class="header-anchor">#</a> 压缩 HTML 代码</h4> <p>使用 html-webpack-plugin 中的 minify 进行压缩。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  minify<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    removeComments<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    collapseWhitespace<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    removeRedundantAttributes<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    useShortDoctype<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    removeEmptyAttributes<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    removeStyleLinkTypeAttributes<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    keepClosingSlash<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    minifyJS<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    minifyCSS<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    minifyURLs<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  chunksSortMode<span class="token punctuation">:</span> <span class="token string">'dependency'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="压缩-css-代码"><a href="#压缩-css-代码" class="header-anchor">#</a> 压缩 CSS 代码</h4> <p>使用 cssnano 压缩 css。在 postcss.config.js 中进行配置。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> cssnano <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cssnano'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>cssnano<span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="图片资源优化"><a href="#图片资源优化" class="header-anchor">#</a> 图片资源优化</h3> <p>刚刚我们介绍了资源打包压缩，只是停留在了代码层面，而在我们实际开发中，真正占用了大量网络传输资源的，并不是这些文件，而是图片，如果你对图片进行了优化工作，你就能立刻看见明显的效果。</p> <h4 id="不要在-html-里缩放图像"><a href="#不要在-html-里缩放图像" class="header-anchor">#</a> 不要在 HTML 里缩放图像</h4> <p>很多开发者可能会有这样的错觉，为了能让用户觉得图片更加清晰，本来为了显示 200x200 的图片，却使用 400x400 的图片，其实不然，在普通的显示器上，用户并不会感到缩放后的大图更加清晰，但这样做会导致网页加载时间变长，同时照成带宽浪费。所以，当你需要用多大的图片时，就在服务器上准备好多大的图片，尽量固定图片尺寸。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>你可能不知道，一张 200KB 的图片和 2M 的图片的传输时间会是 200m 和 12s 的差距。</p></div> <h4 id="使用雪碧图（css-sprite）"><a href="#使用雪碧图（css-sprite）" class="header-anchor">#</a> 使用雪碧图（CSS Sprite）</h4> <p>雪碧图的概念大家一定在生活中经常听见，其实雪碧图是减小请求数的显著运用。而且很奇妙的是，多张图片聘在一块后，总体积会比之前所有图片的体积之和小。</p> <p>推荐一个生成雪碧图的网站：<a href="https://www.toptal.com/developers/css/sprite-generator" target="_blank" rel="noopener noreferrer">www.toptal.com/developers/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h4 id="使用字体图标（iconfont）"><a href="#使用字体图标（iconfont）" class="header-anchor">#</a> 使用字体图标（iconfont）</h4> <p>不论是压缩后的图片，还是雪碧图，终归还是图片，只要是图片，就还是会占用大量网络传输资源。但是字体图标的出现，却让前端开发者看到了另外一个神奇的世界。</p> <p>图片能做的很多事情，字体都能作，而且它只是往 html 里插入字符和 css 样式而已，资源占用和图片请求比起来小太多了。</p> <h4 id="使用-webp"><a href="#使用-webp" class="header-anchor">#</a> 使用 WebP</h4> <p>WebP 格式，是谷歌公司开发的一种旨在加快图片加载速度的图片格式。图片压缩体积大约只有 jpeg 的 2/3，并能节省大量的服务器带宽资源和数据空间。</p> <h3 id="使用-cdn"><a href="#使用-cdn" class="header-anchor">#</a> 使用 CDN</h3> <p>再好的性能优化实例，也必须在 CDN 的支撑下才能到达极致。CDN 原理如下：</p> <ul><li>根据 DNS 找到离你最近的服务器。</li> <li>数据同步策略：热门资源立即同步，不热门数据谁用谁同步。</li></ul> <p>执行以下命令查看用户与服务器之间经过的所有路由器：</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># linux</span>
<span class="token function">traceroute</span> baidu.com
<span class="token comment"># windows</span>
tracert baidu.com
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>不言而喻，用户和服务器之间距离越远，经过的路由器越多，延迟也就越高。使用 CDN 的目的之一便是解决这一问题，当然不仅仅如此，CDN 还可以分担 IDC（互联网数据中心） 压力。</p> <h3 id="使用预加载"><a href="#使用预加载" class="header-anchor">#</a> 使用预加载</h3> <p>在 html 加载时，会加载很多第三方资源，这些资源的优先级是不同的，一些重要资源需要提前进行获取，而一些资源可以延迟进行加载。我们可以使用 <strong>DNS 预解析</strong>，<strong>预加载</strong>，<strong>预渲染</strong>来管理页面资源的加载。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- DNS 预解析 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>dns-prefetch<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>//cdfangyuan.cn<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token comment">&lt;!-- 预加载，指明哪些资源是在页面加载完成后即刻需要的，并提前获取--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>preload<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://example.com<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token comment">&lt;!-- 预渲染，提前加载下一页的数据 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>prerender<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://example.com<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="页面渲染性能优化"><a href="#页面渲染性能优化" class="header-anchor">#</a> 页面渲染性能优化</h2> <p>网络层面的优化介绍完了，接下来我们来介绍一下页面渲染时的优化。</p> <h3 id="浏览器渲染过程（webkit）"><a href="#浏览器渲染过程（webkit）" class="header-anchor">#</a> 浏览器渲染过程（Webkit）</h3> <p><img src="devops-performance-render.png" alt="浏览器渲染过程"></p> <ul><li>parseHTML。解析 html，并构建 dom 树。</li> <li>在解析过程中遇到 link 标记，引用外部的 css 文件。
<ul><li>Recalculate Style。将 css 文件解析成 css 对象模型(cssom)。</li></ul></li> <li>Composite Layers。将 dom 和 cssom 合并成一个渲染树。
<ul><li>将 <code>display：none</code> 的元素从渲染树中删除掉。</li> <li>获取 dom 树，并根据样式将其<strong>分割成多个独立的渲染层</strong>。</li></ul></li> <li>Layout。根据渲染树进行重排。
<ul><li>精确地捕获每个元素在视口内的确切位置和尺寸，所有相对像素都会转换为屏幕上的绝对像素。</li> <li>cpu 将每个渲染层绘制进位图中。</li> <li>将位图作为纹理上传至 gpu 绘制。</li></ul></li> <li>Paint。将各个节点绘制到屏幕上。
<ul><li>这一步通常称为“绘制”或“栅格化”。</li> <li>将 csssom 中的每个节点转换成屏幕上的实际像素。</li> <li>gpu 缓存渲染层，并复合多个渲染层，最终形成我们的图像。</li></ul></li></ul> <h3 id="dom-渲染层与-gpu-硬件加速"><a href="#dom-渲染层与-gpu-硬件加速" class="header-anchor">#</a> DOM 渲染层与 GPU 硬件加速</h3> <p>一个页面在构建完 render tree 之后，是经历了这样的流程才最终呈现在我们面前的：</p> <ul><li>浏览器会先获取 dom 树并依据样式将其分割成多个独立的渲染层。</li> <li>cpu 将每个层绘制进位图中。</li> <li>将位图作为纹理上传至 gpu（显卡）绘制。</li> <li>gpu 将所有的渲染层缓存（如果下次上传的渲染层没有发生变化，gpu 就不需要对其进行重绘）并复合多个渲染层最终形成我们的图像。</li></ul> <p>从上面的步骤我们可以知道，布局是由 cpu 处理的，而绘制则是由 gpu 完成的。</p> <p>我们可以利用 <strong>gpu 缓存来减少页面重绘</strong>，例如：把那些一直发生大量重排重绘的元素提取出来，单独触发一个渲染层，那样这个元素就<strong>不会影响其他层</strong>一块重绘了。</p> <p>什么情况下会触发渲染层呢？</p> <p>video 元素、canvas、css3d、css 滤镜、z-index 大于某个相邻节点的元素都会触发新的渲染层，最常用的方法，就是给某个元素加上下面的样式：</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateZ</span><span class="token punctuation">(</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token property">backface-visibility</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>我们把容易触发重排重绘的元素单独触发渲染层，让它与那些“静态”元素隔离，让 <strong>gpu 分担更多的渲染工作</strong>，我们通常把这样的措施称为硬件加速，或者是 gpu 加速。</p> <h3 id="重排与重绘"><a href="#重排与重绘" class="header-anchor">#</a> 重排与重绘</h3> <ul><li>重排（reflow）：渲染层内的元素布局发生修改，都会导致页面重新排列，比如窗口的尺寸发生变化、删除或添加 DOM 元素，修改了影响元素盒子大小的 css 属性（诸如：width、height、padding）。</li> <li>重绘（repaint）：绘制，即渲染上色，所有对元素的视觉表现属性的修改，都会引发重绘。</li></ul> <p>不论是重排还是重绘，都会阻塞浏览器。要提高网页性能，就要降低重排和重绘的频率和成本，近可能少地触发重新渲染。重排是由 cpu 处理的，而重绘是由 gpu 处理的，cpu 的处理效率远不及 gpu，并且重排一定会引发重绘，而重绘不一定会引发重排。所以在性能优化工作中，我们更应当着重减少重排的发生。</p> <p>这里给大家推荐一个网站，里面详细列出了哪些 css 属性在不同的渲染引擎中是否会触发重排或重绘：<a href="https://csstriggers.com" target="_blank" rel="noopener noreferrer">csstriggers.com<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="优化策略"><a href="#优化策略" class="header-anchor">#</a> 优化策略</h3> <p>谈了那么多理论，最实际不过的，就是解决方案，大家一定都等着急了吧，做好准备，一大波干货来袭：</p> <ul><li><strong>css 属性读写分离</strong>，浏览器每次对元素样式进行读操作时，都必须进行一次重新渲染（重排 + 重绘），所以我们在使用 js 对元素样式进行读写操作时，最好将两者分离开，先读后写，避免出现两者交叉使用的情况。最客观的解决方案，就是不用 js 去操作元素样式。</li> <li><strong>批量修改样式</strong>，通过切换 class 或者 style.csstext 属性去批量操作元素样式。</li> <li><strong>dom 元素离线更新</strong>，当对 dom 进行相关操作时，例如 innerHTML、appendChild 等都可以使用 documentFragment 对象进行离线操作，带元素“组装”完成后再一次插入页面，或者使用 display:none 对元素隐藏，在元素“消失”后进行相关操作。</li> <li><strong>将没用的元素设为不可见</strong>，visibility: hidden，这样可以减小重绘的压力，必要的时候再将元素显示。</li> <li><strong>减少 dom 的深度</strong>，一个渲染层内不要有过深的子元素，少用 dom 完成页面样式，多使用伪元素或者 box-shadow 取代。</li> <li><strong>在渲染前指定图片大小</strong>，因为 img 元素是内联元素，所以在加载图片后会改变宽高，严重的情况会导致整个页面重排，所以最好在渲染前就指定其大小，或者让其脱离文档流。</li> <li><strong>合理使用硬件加速</strong>，对页面中可能发生大量重排重绘的元素单独触发渲染层，使用 gpu 分担 cpu 压力。（这项策略需要慎用，得着重考量以牺牲 gpu 占用率能否换来可期的性能优化，毕竟页面中存在太多的渲染层对与 gpu 而言也是一种不必要的压力，通常情况下，我们会对动画元素采取硬件加速。）</li></ul> <h2 id="其他优化"><a href="#其他优化" class="header-anchor">#</a> 其他优化</h2> <h3 id="pc-端"><a href="#pc-端" class="header-anchor">#</a> PC 端</h3> <ul><li>同一个域名下 3 个 js。</li> <li>整个网页首屏加载的 js 5 个。</li> <li>gzip 之后每个文件大小不超过 31.2KB~ 最大 100。</li></ul> <h3 id="移动端"><a href="#移动端" class="header-anchor">#</a> 移动端</h3> <ul><li>使用 manifest 配置离线应用。</li> <li>利用 localstrage 缓存数据，容量最大 5M ，不能超过 2.5M。
<ul><li>同步，容量小，读取快。</li> <li>localstrage 扩容计划。 iframe + postmessage。</li></ul></li> <li>基于 indexdDB 等异步缓存方案。
<ul><li>容量大，读取慢。</li></ul></li> <li>区分机型 ua，如果机型性能不好，就加载简版页面。</li> <li>网速检测，页面中默认使用 1x 图，如果网速好则用 2x 图。</li></ul> <h3 id="传统页面和单页"><a href="#传统页面和单页" class="header-anchor">#</a> 传统页面和单页</h3> <ul><li>传统页面。
<ul><li>先加载页面骨架，然后 ajax 请求数据，容易白屏。</li></ul></li> <li>传统单页。
<ul><li>利用 ajax 拉去数据，通过 hash 或者 history 管理路由，速度快，seo 不友好。</li></ul></li> <li>前后端同构。
<ul><li>pushstate + ajax，首页进行服务器端渲染，页面内部的跳转由 ajax 获取数据渲染。</li> <li>页面刷新，则直接请求后端，进行服务器端渲染。</li></ul></li></ul> <h2 id="参考链接"><a href="#参考链接" class="header-anchor">#</a> 参考链接</h2> <p><a href="https://juejin.im/post/5b6fa8c86fb9a0099910ac91" target="_blank" rel="noopener noreferrer">网站性能优化实战——从 12.67s 到 1.06s 的故事<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/lmjben/blog/edit/master/docs/blog/devops-performance.md" target="_blank" rel="noopener noreferrer">本文源码地址</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">8/21/2019, 3:26:46 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/devops-image.html" class="prev">合理选择图片格式</a></span> <span class="next"><a href="/blog/devops-commitlint.html">Commitlint 使用总结</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.1485f227.js" defer></script><script src="/assets/js/2.691ff22b.js" defer></script><script src="/assets/js/33.4702ebe7.js" defer></script>
  </body>
</html>
