<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>框架面试题 | yhlben的前端日志</title>
    <meta name="description" content="欢迎访问我的前端日志">
    <link rel="icon" href="/hero.jpeg">
    
    <link rel="preload" href="/assets/css/0.styles.b9e7bdb6.css" as="style"><link rel="preload" href="/assets/js/app.608a412e.js" as="script"><link rel="preload" href="/assets/js/2.9c2b7429.js" as="script"><link rel="preload" href="/assets/js/93.2f8e5ff5.js" as="script"><link rel="prefetch" href="/assets/js/10.a3a0918d.js"><link rel="prefetch" href="/assets/js/11.8791ec7a.js"><link rel="prefetch" href="/assets/js/12.964207f0.js"><link rel="prefetch" href="/assets/js/13.54ca87e4.js"><link rel="prefetch" href="/assets/js/14.239869d6.js"><link rel="prefetch" href="/assets/js/15.7ebc30ab.js"><link rel="prefetch" href="/assets/js/16.5a51c354.js"><link rel="prefetch" href="/assets/js/17.9f294915.js"><link rel="prefetch" href="/assets/js/18.fa74f7e7.js"><link rel="prefetch" href="/assets/js/19.0e448308.js"><link rel="prefetch" href="/assets/js/20.d5abe334.js"><link rel="prefetch" href="/assets/js/21.6498aada.js"><link rel="prefetch" href="/assets/js/22.bed79db8.js"><link rel="prefetch" href="/assets/js/23.c7901eb4.js"><link rel="prefetch" href="/assets/js/24.ee6b7365.js"><link rel="prefetch" href="/assets/js/25.595ce3f3.js"><link rel="prefetch" href="/assets/js/26.e247e815.js"><link rel="prefetch" href="/assets/js/27.e63d05a3.js"><link rel="prefetch" href="/assets/js/28.b98194f6.js"><link rel="prefetch" href="/assets/js/29.98bb196f.js"><link rel="prefetch" href="/assets/js/3.e73d3cf5.js"><link rel="prefetch" href="/assets/js/30.008c43f2.js"><link rel="prefetch" href="/assets/js/31.1b8d398a.js"><link rel="prefetch" href="/assets/js/32.b01005c5.js"><link rel="prefetch" href="/assets/js/33.385aa952.js"><link rel="prefetch" href="/assets/js/34.6991fd47.js"><link rel="prefetch" href="/assets/js/35.732919d6.js"><link rel="prefetch" href="/assets/js/36.358c64de.js"><link rel="prefetch" href="/assets/js/37.f7b202bb.js"><link rel="prefetch" href="/assets/js/38.b6c9a483.js"><link rel="prefetch" href="/assets/js/39.7a3e3e72.js"><link rel="prefetch" href="/assets/js/4.2a5d82e4.js"><link rel="prefetch" href="/assets/js/40.450bdd4a.js"><link rel="prefetch" href="/assets/js/41.800828bb.js"><link rel="prefetch" href="/assets/js/42.31566c2b.js"><link rel="prefetch" href="/assets/js/43.159753ea.js"><link rel="prefetch" href="/assets/js/44.a10b80c0.js"><link rel="prefetch" href="/assets/js/45.b15ab0f7.js"><link rel="prefetch" href="/assets/js/46.c0244ce4.js"><link rel="prefetch" href="/assets/js/47.7685a562.js"><link rel="prefetch" href="/assets/js/48.a3262373.js"><link rel="prefetch" href="/assets/js/49.c9386ff1.js"><link rel="prefetch" href="/assets/js/5.4e3625bb.js"><link rel="prefetch" href="/assets/js/50.f5d0da1d.js"><link rel="prefetch" href="/assets/js/51.99321c45.js"><link rel="prefetch" href="/assets/js/52.16de4e1f.js"><link rel="prefetch" href="/assets/js/53.b7dc15cb.js"><link rel="prefetch" href="/assets/js/54.9b0076bd.js"><link rel="prefetch" href="/assets/js/55.1bb9aae6.js"><link rel="prefetch" href="/assets/js/56.87532b60.js"><link rel="prefetch" href="/assets/js/57.346f9d9f.js"><link rel="prefetch" href="/assets/js/58.be842b39.js"><link rel="prefetch" href="/assets/js/59.be1dcb9a.js"><link rel="prefetch" href="/assets/js/6.a3a75ea6.js"><link rel="prefetch" href="/assets/js/60.314eb132.js"><link rel="prefetch" href="/assets/js/61.4b4cef62.js"><link rel="prefetch" href="/assets/js/62.9c647843.js"><link rel="prefetch" href="/assets/js/63.b09c3f57.js"><link rel="prefetch" href="/assets/js/64.45dc798a.js"><link rel="prefetch" href="/assets/js/65.1d4afb69.js"><link rel="prefetch" href="/assets/js/66.d0193f0c.js"><link rel="prefetch" href="/assets/js/67.1a1146f7.js"><link rel="prefetch" href="/assets/js/68.f122df06.js"><link rel="prefetch" href="/assets/js/69.b23b0049.js"><link rel="prefetch" href="/assets/js/7.95b6c695.js"><link rel="prefetch" href="/assets/js/70.53f026ab.js"><link rel="prefetch" href="/assets/js/71.97a86045.js"><link rel="prefetch" href="/assets/js/72.f7e99221.js"><link rel="prefetch" href="/assets/js/73.0d2da87a.js"><link rel="prefetch" href="/assets/js/74.e8257c51.js"><link rel="prefetch" href="/assets/js/75.57cbb28e.js"><link rel="prefetch" href="/assets/js/76.c654a7d7.js"><link rel="prefetch" href="/assets/js/77.3f7aec3d.js"><link rel="prefetch" href="/assets/js/78.861a0fc4.js"><link rel="prefetch" href="/assets/js/79.2575fc4f.js"><link rel="prefetch" href="/assets/js/8.56088239.js"><link rel="prefetch" href="/assets/js/80.315e65af.js"><link rel="prefetch" href="/assets/js/81.2ac0391d.js"><link rel="prefetch" href="/assets/js/82.fbd4c02b.js"><link rel="prefetch" href="/assets/js/83.b5028d14.js"><link rel="prefetch" href="/assets/js/84.27cb9229.js"><link rel="prefetch" href="/assets/js/85.9004aceb.js"><link rel="prefetch" href="/assets/js/86.22bf2228.js"><link rel="prefetch" href="/assets/js/87.3ae9fb2c.js"><link rel="prefetch" href="/assets/js/88.c07589d5.js"><link rel="prefetch" href="/assets/js/89.cbe25ca2.js"><link rel="prefetch" href="/assets/js/9.5ebfc5b6.js"><link rel="prefetch" href="/assets/js/90.dd934344.js"><link rel="prefetch" href="/assets/js/91.78dc81a4.js"><link rel="prefetch" href="/assets/js/92.f65ebd33.js"><link rel="prefetch" href="/assets/js/94.f798de2b.js"><link rel="prefetch" href="/assets/js/95.392d73bd.js"><link rel="prefetch" href="/assets/js/96.e5e13b53.js"><link rel="prefetch" href="/assets/js/97.8fb3441d.js"><link rel="prefetch" href="/assets/js/98.74808cf3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b9e7bdb6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">yhlben的前端日志</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">博客</a></div><div class="nav-item"><a href="/interview/" class="nav-link router-link-active">面试题</a></div><div class="nav-item"><a href="/book/" class="nav-link">阅读</a></div> <a href="https://github.com/yhlben/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">博客</a></div><div class="nav-item"><a href="/interview/" class="nav-link router-link-active">面试题</a></div><div class="nav-item"><a href="/book/" class="nav-link">阅读</a></div> <a href="https://github.com/yhlben/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview/js.html" class="sidebar-link">JS 面试题</a></li><li><a href="/interview/css.html" class="sidebar-link">CSS 面试题</a></li><li><a href="/interview/html.html" class="sidebar-link">HTML 面试题</a></li><li><a href="/interview/framework.html" class="active sidebar-link">框架面试题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview/framework.html#_1、react-vue-使用感受" class="sidebar-link">1、React Vue 使用感受</a></li><li class="sidebar-sub-header"><a href="/interview/framework.html#_2、单向数据流和双向数据流有什么区别" class="sidebar-link">2、单向数据流和双向数据流有什么区别</a></li><li class="sidebar-sub-header"><a href="/interview/framework.html#_3、react-优点" class="sidebar-link">3、React 优点</a></li><li class="sidebar-sub-header"><a href="/interview/framework.html#_4、vue-优点" class="sidebar-link">4、Vue 优点</a></li><li class="sidebar-sub-header"><a href="/interview/framework.html#_5、webpack-插件怎么编写" class="sidebar-link">5、webpack 插件怎么编写</a></li><li class="sidebar-sub-header"><a href="/interview/framework.html#_6、webpack-loader-编写" class="sidebar-link">6、webpack loader 编写</a></li><li class="sidebar-sub-header"><a href="/interview/framework.html#_7、webpack-插件之间怎么互相通信" class="sidebar-link">7、webpack 插件之间怎么互相通信</a></li><li class="sidebar-sub-header"><a href="/interview/framework.html#_8、react-中是否必须将所有状态都放入-redux" class="sidebar-link">8、React 中是否必须将所有状态都放入 Redux</a></li><li class="sidebar-sub-header"><a href="/interview/framework.html#_9-请描述一下-vuex-中的几大模块之间的作用" class="sidebar-link">9. 请描述一下 Vuex 中的几大模块之间的作用</a></li><li class="sidebar-sub-header"><a href="/interview/framework.html#_10、说说你理解的-flutter" class="sidebar-link">10、说说你理解的 Flutter</a></li><li class="sidebar-sub-header"><a href="/interview/framework.html#_11、在-react-中，为什么最好在-componentdidmount-中发起请求" class="sidebar-link">11、在 React 中，为什么最好在 ComponentDidMount 中发起请求</a></li><li class="sidebar-sub-header"><a href="/interview/framework.html#_12、简述一下-react-中的事件机制" class="sidebar-link">12、简述一下 React 中的事件机制</a></li><li class="sidebar-sub-header"><a href="/interview/framework.html#_13、什么是可控组件和不可控组件" class="sidebar-link">13、什么是可控组件和不可控组件</a></li><li class="sidebar-sub-header"><a href="/interview/framework.html#_14、react-异步渲染原理" class="sidebar-link">14、React 异步渲染原理</a></li><li class="sidebar-sub-header"><a href="/interview/framework.html#_15、react-dom-diff-原理" class="sidebar-link">15、React Dom Diff 原理</a></li><li class="sidebar-sub-header"><a href="/interview/framework.html#_16、vue-dom-diff-算法原理" class="sidebar-link">16、Vue Dom Diff 算法原理</a></li><li class="sidebar-sub-header"><a href="/interview/framework.html#_17、react-16-dom-diff-原理" class="sidebar-link">17、React 16 Dom Diff 原理</a></li><li class="sidebar-sub-header"><a href="/interview/framework.html#_18、redux-中间件处理原理" class="sidebar-link">18、Redux 中间件处理原理</a></li><li class="sidebar-sub-header"><a href="/interview/framework.html#_19、nodejs-中-setimmediate-和-settimeout-的执行顺序" class="sidebar-link">19、Nodejs 中 setImmediate 和 setTimeout 的执行顺序</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>编程基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview/base.html" class="sidebar-link">基础面试题</a></li><li><a href="/interview/structure.html" class="sidebar-link">数据结构面试题</a></li><li><a href="/interview/suanfa.html" class="sidebar-link">算法面试题</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="框架面试题"><a href="#框架面试题" aria-hidden="true" class="header-anchor">#</a> 框架面试题</h1> <h2 id="_1、react-vue-使用感受"><a href="#_1、react-vue-使用感受" aria-hidden="true" class="header-anchor">#</a> 1、React Vue 使用感受</h2> <p>遇到这个开放式的问题，我也是楞了一下，要是之前能稍微总结一下就能回答得更好。</p> <p>相同点：</p> <ol><li>虚拟 DOM</li> <li>组件化</li> <li>保持对视图的关注</li> <li>数据驱动视图</li> <li>都有支持 native 的方案</li></ol> <p>不同点：</p> <ol><li>state 状态管理 vs 对象属性 get，set。</li> <li>vue 实现了数据的双向绑定 v-model，而组件之间的 props 传递是单向的，react 数据流动是单向的。</li></ol> <h3 id="运行时优化"><a href="#运行时优化" aria-hidden="true" class="header-anchor">#</a> 运行时优化</h3> <p>在 React 应用中，当某个组件的状态发生变化时，它会以该组件为根，重新渲染整个组件子树，开发者不得不手动使用 shouldComponentUpdate 去优化性能。</p> <p>在 Vue 组件的依赖是在渲染过程中自动追踪的，开发者不再需要考虑此类优化。另外 Vue 还做了很多其他方面的优化，例如：标记静态节点，优化静态循环等。</p> <blockquote><p>总结：Vue 在运行时帮我们做了很多优化了处理，开发者可以直接上手，React 则是由开发者自己去处理优化，让程序有更多的定制化。</p></blockquote> <h3 id="jsx-vs-templates"><a href="#jsx-vs-templates" aria-hidden="true" class="header-anchor">#</a> JSX vs Templates</h3> <p>JSX 中你可以使用完整的编程语言 JavaScript 功能来构建你的视图页面。比如你可以使用临时变量、JS 自带的流程控制、以及直接引用当前 JS 作用域中的值等等。</p> <p>Templates 对于很多习惯了 HTML 的开发者来说，模板比起 JSX 读写起来更自然。基于 HTML 的模板使得将已有的应用逐步迁移到 Vue 更为容易。你甚至可以使用其他模板预处理器，比如 Pug 来书写 Vue 的模板。</p> <blockquote><p>总结：Vue 在模板上实现定制化，可以使用类 HTML 模板，以及可以使用 JSX，React 则是推荐 JSX。</p></blockquote> <h3 id="生态圈"><a href="#生态圈" aria-hidden="true" class="header-anchor">#</a> 生态圈</h3> <p>Vue 的路由库和状态管理库都是由<strong>官方维护</strong>支持且与核心库同步更新的。</p> <p>React 的路由库和状态管理库是由社区维护，因此创建了一个更分散的生态系统。React 的生态系统相比 Vue 更加繁荣。</p> <h2 id="_2、单向数据流和双向数据流有什么区别"><a href="#_2、单向数据流和双向数据流有什么区别" aria-hidden="true" class="header-anchor">#</a> 2、单向数据流和双向数据流有什么区别</h2> <h3 id="单向数据流"><a href="#单向数据流" aria-hidden="true" class="header-anchor">#</a> 单向数据流</h3> <p>优点：</p> <ol><li>所有状态的改变可记录、可跟踪，源头易追溯。</li> <li>所有数据只有一份，组件数据只有唯一的入口和出口，使得程序更直观更容易理解，有利于应用的可维护性。</li> <li>一旦数据变化，就去更新页面(data -&gt; 页面)，没有(页面 -&gt; data)。</li> <li>如果用户在页面上做了变动，需要手动更新数据。</li></ol> <p>缺点：</p> <ol><li>HTML 代码渲染完成，无法改变，新数据到来时，就会整合新数据和模板重新渲染。</li> <li>代码量上升，数据流转换过程变长，需要进行统一的数据流管理，例如：redux。</li></ol> <h3 id="双向数据流"><a href="#双向数据流" aria-hidden="true" class="header-anchor">#</a> 双向数据流</h3> <p>双向绑定 = 单向绑定 + UI 事件监听。</p> <p>优点：</p> <ol><li>用户在视图上的修改会自动同步到数据模型中去，数据模型中值的变化也会立刻同步到视图中去。</li> <li>在表单交互较多的场景下，会简化大量业务无关的代码。</li></ol> <p>缺点：</p> <ol><li>无法追踪局部状态的变化。</li> <li>可能存在暗箱操作，增加了出错时 debug 的难度。</li> <li>由于组件数据变化来源入口不止一个，数据流转方向易混乱，如果不加以控制，容易出错。</li></ol> <h2 id="_3、react-优点"><a href="#_3、react-优点" aria-hidden="true" class="header-anchor">#</a> 3、React 优点</h2> <ol><li>函数式编程思想，无状态组件，同样的 prop 对应同样的输出。</li> <li>虚拟 dom，firber，底层优化，提高渲染效率。</li> <li>模块化思想，复用性更强。</li> <li>单向数据流，让事情一目了然。</li> <li>以 js 为中心，使用 jsx 开发页面，css in js 书写样式。</li> <li>支持服务器端渲染。</li> <li>一套代码多端运行。</li></ol> <p>缺点：</p> <ol><li>只是视图层，构建大型项目的话，需要引入 redux 和 react-router 等相关的东西。</li></ol> <h2 id="_4、vue-优点"><a href="#_4、vue-优点" aria-hidden="true" class="header-anchor">#</a> 4、Vue 优点</h2> <ol><li>类 HTML 模板语法，更容易上手。</li> <li>模块化思想，复用性强。</li> <li>虚拟 dom，运行时优化，提高渲染效率。</li> <li>支持双向数据绑定，易用性强。</li> <li>支持服务器端渲染。</li></ol> <p>缺点：</p> <ol><li>社区不如 react，大多是中国开发者。</li> <li>生态圈不够，vue 全家桶都是 vue 官方自己出的东西。</li></ol> <h2 id="_5、webpack-插件怎么编写"><a href="#_5、webpack-插件怎么编写" aria-hidden="true" class="header-anchor">#</a> 5、webpack 插件怎么编写</h2> <p>webpack 就像是一条生产线，要经过一系列流程处理之后才能将源文件转换成输出结果。</p> <p>webpack plugin 实质就是一个类，在被创建的时候，会监听 webpack 生产线上的事件，然后加入生产线中，改变生产线输出。</p> <p>webpack 启动后，会读取配置中的 plugins，并创建对应实例，在 webpack 初始化 compiler 对象之后，再调用 plugin 中的 apply 方法，把 compiler 注入到插件中。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">HelloAsyncPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// tapAsync() 基于回调(callback-based)</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>emit<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span><span class="token string">'HelloAsyncPlugin'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>
      <span class="token parameter">compilation<span class="token punctuation">,</span>
      callback</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Done with async work...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// tapPromise() 基于 promise(promise-based)</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>emit<span class="token punctuation">.</span><span class="token function">tapPromise</span><span class="token punctuation">(</span><span class="token string">'HelloAsyncPlugin'</span><span class="token punctuation">,</span> <span class="token parameter">compilation</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">doSomethingAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Done with async work...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 原先基本的 tap() 也在这里列出：</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>emit<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'HelloAsyncPlugin'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 这里没有异步任务</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Done with sync work...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> HelloAsyncPlugin<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h2 id="_6、webpack-loader-编写"><a href="#_6、webpack-loader-编写" aria-hidden="true" class="header-anchor">#</a> 6、webpack loader 编写</h2> <p>webpack loader 实质就是一个<code>function</code>，function 中会被注入需要被处理的资源，然后加以处理。</p> <p>loader 的执行时会先执行最后的 loader，然后再执行前一个 loader，如果想按顺序执行，可以定义 pitch 方法。</p> <p>loader 一般会使用 acorn 将代码转换过成 ast 语法树，然后再进行对应的操作，最后再转换会字符串。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> getOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'loader-utils'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> validateOptions <span class="token keyword">from</span> <span class="token string">'schema-utils'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token string">'object'</span><span class="token punctuation">,</span>
  properties<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    test<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token string">'string'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">validateOptions</span><span class="token punctuation">(</span>schema<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token string">'Example Loader'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 对资源应用一些转换……</span>

  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">export default </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// pitch方法，在捕获阶段执行的函数</span>
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span><span class="token function-variable function">pitch</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">remainingRequest<span class="token punctuation">,</span> precedingRequest<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  data<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="_7、webpack-插件之间怎么互相通信"><a href="#_7、webpack-插件之间怎么互相通信" aria-hidden="true" class="header-anchor">#</a> 7、webpack 插件之间怎么互相通信</h2> <p>在 webpack 中，通过 tapable 管理运行时的各种事件流，不同的 webpack plugins 可以通过自定义事件相互通信。</p> <p>例如：在 <code>Bplugin</code> 中监听 <code>Aplugin</code> 中的事件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// A 插件</span>
<span class="token keyword">const</span> SyncHook <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'tapable'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>SyncHook<span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">APlugin</span> <span class="token punctuation">{</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>myCustomHook<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Already in use'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 声明一个自定义事件，并初始化需要传递的参数。</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>myCustomHook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'参数1'</span><span class="token punctuation">,</span> <span class="token string">'参数2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 在当前插件中监听自定义事件</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>myCustomHook<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'APlugin'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'获取到参数：'</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 可以在任意的钩子函数中去触发自定义事件</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>compilation<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'APlugin'</span><span class="token punctuation">,</span> <span class="token parameter">compilation</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      compilation<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>afterOptimizeChunkAssets<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'APlugin'</span><span class="token punctuation">,</span> <span class="token parameter">chunks</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">myCustomHook</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// B 插件</span>
<span class="token keyword">class</span> <span class="token class-name">BPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 监听A组件定义的事件</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>myCustomHook<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'BPlugin'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'获取到参数：'</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h2 id="_8、react-中是否必须将所有状态都放入-redux"><a href="#_8、react-中是否必须将所有状态都放入-redux" aria-hidden="true" class="header-anchor">#</a> 8、React 中是否必须将所有状态都放入 Redux</h2> <p>我们都知道，如果把状态都存在 redux 中，就可以编写出更多无状态的组件。</p> <p>无状态组件优点：</p> <ul><li>代码整洁、可读性高</li> <li>无状态组件的性能好</li></ul> <p>个人理解，并不是所有的 state 都存放在 redux 里比较好，应该考虑一下几点：</p> <ul><li>该应用程序的其他部分是否关心此数据？</li> <li>您是否需要能够根据此原始数据创建更多派生数据？</li> <li>是否使用相同的数据来驱动多个组件？</li> <li>能够将此状态恢复到给定时间点？</li> <li>你想缓存数据？</li></ul> <p>如果你没有以上的需要，就不要把 state 放入 redux 中。</p> <h2 id="_9-请描述一下-vuex-中的几大模块之间的作用"><a href="#_9-请描述一下-vuex-中的几大模块之间的作用" aria-hidden="true" class="header-anchor">#</a> 9. 请描述一下 Vuex 中的几大模块之间的作用</h2> <p>vuex 的原理很简单，简单来说：</p> <ul><li>view dispatch 一个 action。</li> <li>action commit 一个 mutation。</li> <li>mutation 修改 store 后，重新更新视图。</li></ul> <p><img src="https://vuex.vuejs.org/vuex.png" alt="vuex 流程图"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 创建一个store，如果需要拆分，可以将不同的模块挂载到 modules 上。</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// store 中的对象</span>
  state<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    count<span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 唯一改变 store 的方法，只能是同步更新</span>
  mutations<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">increment</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">.</span>count<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// action 派发一个 mutation，可以使用异步方法</span>
  actions<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">increment</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        context<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'increment'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 派生 store 中的状态</span>
  getters<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">showCount</span><span class="token punctuation">:</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">'当前的count是：'</span> <span class="token operator">+</span> state<span class="token punctuation">.</span>count<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>获取声明的 store，为了方便调用 store 上的 state，getter，action，vuex 提供了 mapState，mapGetters，mapActions 方法。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> mapState<span class="token punctuation">,</span> mapGetters<span class="token punctuation">,</span> mapActions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span>；

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">otherCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token function-variable function">count</span><span class="token punctuation">:</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>count<span class="token comment">// 把 `this.count` 映射为 `this.$store.state.count`</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token operator">...</span><span class="token function">mapGetters</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token string">'showCount'</span><span class="token comment">// 把 `this.showCount` 映射为 `this.$store.getters.showCount`</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token punctuation">:</span><span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token string">'increment'</span><span class="token comment">// 将 `this.increment()` 映射为 `this.$store.dispatch('increment')`</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h2 id="_10、说说你理解的-flutter"><a href="#_10、说说你理解的-flutter" aria-hidden="true" class="header-anchor">#</a> 10、说说你理解的 Flutter</h2> <p>在 Flutter 诞生之前，已经有许多跨平台 UI 框架的方案，比如基于 WebView 的 Cordova、AppCan 等，还有使用 HTML + JS 渲染成原生控件的 React Native、Weex 等。</p> <p>基于 WebView 的框架优点很明显，它们几乎可以完全继承现代 Web 开发的所有成果（丰富的控件库、满足各种需求的页面框架、完全的动态化、自动化测试工具等），当然也包括 Web 开发人员，不需要太多的学习和迁移成本就可以开发一个 App。同时 WebView 框架也有一个致命的缺点，那就是 <strong>WebView 的渲染效率和 JS 执行性能太差。再加上 Android 各个系统版本和设备厂商的定制，很难保证所在所有设备上都能提供一致的体验</strong>。</p> <p>为了解决 WebView 性能差的问题，以 React Native 为代表的一类框架将最终渲染工作交还给了系统，虽然同样使用类 HTML + JS 的 UI 构建逻辑，但是<strong>最终会生成对应的自定义原生控件</strong>，以充分利用原生控件相对于 WebView 的较高的绘制效率。与此同时这种策略也将框架本身和 App 开发者绑在了系统的控件系统上，不仅<strong>框架本身需要处理大量平台相关的逻辑</strong>，随着系统版本变化和 API 的变化，开发者可能也需要处理不同平台的差异，甚至有些特性只能在部分平台上实现，这样框架的跨平台特性就会大打折扣。</p> <p>Flutter 则开辟了一种全新的思路，从头到尾重写一套跨平台的 UI 框架，包括 UI 控件、渲染逻辑甚至开发语言。渲染引擎依靠跨平台的 Skia 图形库来实现，依赖系统的只有图形绘制相关的接口，<strong>可以在最大程度上保证不同平台、不同设备的体验一致性</strong>，逻辑处理使用支持 AOT 的 Dart 语言，<strong>执行效率也比 JS 高得多</strong>。</p> <h2 id="_11、在-react-中，为什么最好在-componentdidmount-中发起请求"><a href="#_11、在-react-中，为什么最好在-componentdidmount-中发起请求" aria-hidden="true" class="header-anchor">#</a> 11、在 React 中，为什么最好在 ComponentDidMount 中发起请求</h2> <p>1、react filber 中可能多次调用 render 之前的生命周期函数，可能会请求多次。</p> <p>2、componentWillMount 在服务器端渲染时，服务器端会执行一次，客户端也会执行一次。</p> <p>3、如果请求在 componentWillMount，react 并没有挂载到 dom 上，这时候 setState 可能会有问题。</p> <h2 id="_12、简述一下-react-中的事件机制"><a href="#_12、简述一下-react-中的事件机制" aria-hidden="true" class="header-anchor">#</a> 12、简述一下 React 中的事件机制</h2> <p>React 其实自己实现了一套事件机制，首先我们考虑一下以下代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">Test</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> list<span class="token punctuation">,</span> handleClick <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>span onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleClick<span class="token punctuation">}</span> key<span class="token operator">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>以上类似代码想必大家经常会写到，但是你是否考虑过点击事件是否绑定在了每一个标签上？实际上并不是，JSX 上写的事件并没有绑定在对应的真实 DOM 上，而是通过事件代理的方式，将所有的事件都统一绑定在了 document 上。这样的方式不仅减少了内存消耗，还能在组件挂载销毁时统一订阅和移除事件。</p> <p>另外冒泡到 document 上的事件也不是原生浏览器事件，而是 React 自己实现的合成事件。因此不能使用 event.stopPropagation 阻止事件冒泡，而应该使用 event.preventDefault。</p> <div class="tip custom-block"><ul><li>合成事件首先抹平了浏览器之间的兼容问题，另外这是一个跨浏览器原生事件包装器，赋予了跨浏览器开发的能力。</li> <li>合成事件在运行时，有一个事件池专门来管理它们的创建和销毁，当事件需要被使用时，就会从池子中复用对象，事件回调结束后，就会销毁事件对象上的属性，从而便于下次复用事件对象。</li></ul></div> <h2 id="_13、什么是可控组件和不可控组件"><a href="#_13、什么是可控组件和不可控组件" aria-hidden="true" class="header-anchor">#</a> 13、什么是可控组件和不可控组件</h2> <p>在 html 中，像<code>&lt;input&gt;</code>,<code>&lt;textarea&gt;</code>, 和 <code>&lt;select&gt;</code>这类表单元素会维持自身的值 value，并根据用户输入进行更新。但在 react 中，可变的状态是保存在组件的 state 中的，并且只能用 setState 方法进行更新。</p> <p>我们可以编写双向绑定，统一管理状态：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">changeValue</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>
    value <span class="token punctuation">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>value<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>input oninput<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeValue<span class="token punctuation">}</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>通过 react 统一管理状态后的组件，又叫做可控组件。</p> <h2 id="_14、react-异步渲染原理"><a href="#_14、react-异步渲染原理" aria-hidden="true" class="header-anchor">#</a> 14、React 异步渲染原理</h2> <p>React 不会保证在 setState 之后，能够立刻拿到改变的结果。</p> <p>setState 渲染流程如下：</p> <ul><li>在 setState 中调用了 enqueueSetState 方法将传入的 state 放到一个队列中。</li> <li>enqueueSetState 中先是找到需渲染组件并将新的 state 并入该组件的需更新的 state 队列中，接下来调用了 enqueueUpdate 方法。</li> <li>isBatchingUpdates 表示是否在一个更新组件的事务流中。
<ul><li>已在事务流中，将需更新的组件放入 dirtyComponents 中，在下一次渲染时才会更新 state。</li> <li>未在事务流中，调用 batchedUpdates 方法进入更新流程，进入流程后，会将 isBatchingUpdates 设置为 true。</li></ul></li></ul> <p>这里衍生出了一个问题，什么时候会标识 isBatchingUpdates 为 true？</p> <ul><li>当处于生命周期 render 之后的生命周期中。</li> <li>合成事件中（jsx 中的事件都是合成事件）。</li></ul> <p>案例：在 setTimeout 中执行 setstate 时，没有在 react 事务流中，所以会直接进入更新路程，同步渲染。</p> <h2 id="_15、react-dom-diff-原理"><a href="#_15、react-dom-diff-原理" aria-hidden="true" class="header-anchor">#</a> 15、React Dom Diff 原理</h2> <p>React dom diff 操作流程如下：</p> <ul><li>深度优先遍历</li> <li>同层节点依次比较（跨层次比较时间复杂度高，性能低下）
<ul><li>只有一个子节点 (1)
<ul><li>比较节点类型，类型不一致，直接删除，替换。</li> <li>比较节点属性，不一致，就修改属性值。</li> <li>比较节点的 children。</li></ul></li> <li>子节点是一个数组。
<ul><li>无 key。
<ul><li>newChild 和 oldChild 一对一比较和 (1) 比较方式一致。</li></ul></li> <li>有 key
<ul><li>通过 key 找到可以复用的 oldChild，然后进行移动操作，具体操作见下文。</li></ul></li></ul></li></ul></li></ul> <p>对于有 key 时的具体移动操作，React 使用了顺序优化手段，我们仔细看一下。</p> <ul><li>遍历新子节点 newChildren。</li> <li>lastIndex 用来存储寻找过程中遇到的最大老节点 oldChildren 的索引值。</li> <li>找到第一个 newChild 对应的 oldChildren 中的索引 _mountIndex，并赋值给 lastIndex。</li> <li>找到第二个 newChild，比较 lastIndex 和当前 <code>newChild._mountIndex</code>。
<ul><li>lastIndex &lt; <code>child._mountIndex</code>，证明在老节点中 child2 在 child1 之后，而新节点中 child2 在 child1 之后，顺序一致，不需要进行交换。
<ul><li>lastIndex = <code>child._mountIndex</code> 将 lastIndex 始终指向当前遍历中最大的 oldChildren 索引。</li></ul></li> <li>lastIndex &gt; <code>child._mountIndex</code>，证明在老节点中 child2 在 child1 之前，而新节点中 child2 在 child1 之后，顺序不一致，则需要进行交换。
<ul><li>按照 newChildren 的顺序进行排列。</li> <li>由于 newChild2 在 newChild1 之后，则需要将 oldChild2 移动到 oldChild1 后面。</li></ul></li></ul></li> <li>找到第三个 newChild，如果是一个新节点。
<ul><li>直接将该 newChild 插入到之前的节点后面。</li></ul></li> <li>找到第四个 newChild...
<ul><li>直到 newChildren 遍历完成。</li></ul></li> <li>遍历老子节点 oldChildren。
<ul><li>比较 oldChild 是否在 newChildren 中。</li> <li>如果 oldChild 不在 newChildren 中，直接删除。</li></ul></li></ul> <p>React Dom Diff 算法其实还是有一些问题，例如：将 [1,2,3,4,5]，变成 [5,1,2,3,4]，则会进行 4 次移动操作，所以，尽量减少类似将最后一个节点移动到列表首部的操作，当节点数量过大或更新操作过于频繁时，在一定程度上会影响 React 的渲染性能。</p> <p>其实，为了解决这个问题，Vue 使用了双端比较的方法。</p> <h2 id="_16、vue-dom-diff-算法原理"><a href="#_16、vue-dom-diff-算法原理" aria-hidden="true" class="header-anchor">#</a> 16、Vue Dom Diff 算法原理</h2> <p>这里是指 Vue2.x 中的 Diff 算法，底层使用<a href="https://github.com/snabbdom/snabbdom" target="_blank" rel="noopener noreferrer">snabbdom<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>库。</p> <p>Vue 中的 Diff 算法，使用双端比较的原理进行 Dom 比较操作，避免这种多余的 DOM 移动。</p> <p>例如：比较两个 children 数组，需要四个指针，分别指向 oldStartIdx、oldEndIdx、newStartIdx，newEndIdx。</p> <ul><li>newChildren[newStartIdx] 和 oldChildren[oldStartIdx] 比较。
<ul><li>如果一致，直接复用节点，并将指针往后移 <code>newStartIdx++;oldStartIdx++</code>。</li> <li>不一致，不可复用，则什么都不做。</li></ul></li> <li>newChildren[newEndIdx] 和 oldChildren[oldEndIdx] 比较。
<ul><li>如果一致，直接复用节点，并将指针往后移 <code>newEndIdx--;oldEndIdx--</code>。</li> <li>不一致，不可复用，则什么都不做。</li></ul></li> <li>newChildren[newStartIdx] 和 oldChildren[oldEndIdx] 比较。
<ul><li>如果一致，直接将节点进行移动，并将指针往后移 <code>newStartIdx++;oldEndIdx--</code>。</li> <li>不一致，不可复用，则什么都不做。</li></ul></li> <li>newChildren[newEndIdx] 和 oldChildren[oldStartIdx] 比较。
<ul><li>如果一致，直接将节点进行移动，并将指针往后移 <code>newEndIdx--;oldStartIdx++</code>。</li> <li>不一致，不可复用，则什么都不做。</li></ul></li> <li>如果上述条件都不满足，并且是一个新节点。
<ul><li>直接插入节点（这个时候可能导致页面重排）。</li> <li>同时双指针往后移。</li></ul></li> <li>如果上述条件都不满足，但能找到 oldChildren 其他位置的 key 可以复用。
<ul><li>先将 oldChild 位置移动到新的位置上。</li> <li>然后设置 <code>oldChild.nodeValue = undefined</code>。</li> <li>同时双指针往后移。</li></ul></li> <li>当出现 <code>newStartIdx&gt;=newEndIdx</code> 表示 newChildren 越界。
<ul><li>直接删除剩下的 oldChildren。</li></ul></li> <li>当出现 <code>oldStartIdx&gt;=oldEndIdx</code> 表示 oldChildren 越界。
<ul><li>直接插入剩下的 newChildren。</li></ul></li></ul> <p>具体的部分源码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">updateChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> oldStartIdx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> newStartIdx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> oldEndIdx <span class="token operator">=</span> oldCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> newEndIdx <span class="token operator">=</span> newCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>

  <span class="token keyword">while</span> <span class="token punctuation">(</span>oldStartIdx <span class="token operator">&lt;=</span> oldEndIdx <span class="token operator">&amp;&amp;</span> newStartIdx <span class="token operator">&lt;=</span> newEndIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// Vnode has been moved left</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// patchVnode();</span>
      <span class="token comment">// 节点相同，不做任何处理</span>
      oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
      newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// patchVnode();</span>
      <span class="token comment">// 节点相同，不做任何处理</span>
      oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
      newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">--</span>newEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//  patchVnode();</span>
      <span class="token comment">// 首或尾一致，进行移动</span>
      canMove <span class="token operator">&amp;&amp;</span>
        nodeOps<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>
          parentElm<span class="token punctuation">,</span>
          oldStartVnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span>
          nodeOps<span class="token punctuation">.</span><span class="token function">nextSibling</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">.</span>elm<span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
      newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">--</span>newEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//  patchVnode();</span>
      <span class="token comment">// 首或尾一致，进行移动</span>
      canMove <span class="token operator">&amp;&amp;</span>
        nodeOps<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> oldEndVnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>elm<span class="token punctuation">)</span><span class="token punctuation">;</span>
      oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
      newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>oldKeyToIdx<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        oldKeyToIdx <span class="token operator">=</span> <span class="token function">createKeyToOldIdx</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">,</span> oldStartIdx<span class="token punctuation">,</span> oldEndIdx<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 首尾都不一致，寻找是否能复用之前的其他节点，通过 key 进行判断</span>
      idxInOld <span class="token operator">=</span> <span class="token function">isDef</span><span class="token punctuation">(</span>newStartVnode<span class="token punctuation">.</span>key<span class="token punctuation">)</span>
        <span class="token operator">?</span> oldKeyToIdx<span class="token punctuation">[</span>newStartVnode<span class="token punctuation">.</span>key<span class="token punctuation">]</span>
        <span class="token punctuation">:</span> <span class="token function">findIdxInOld</span><span class="token punctuation">(</span>newStartVnode<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> oldStartIdx<span class="token punctuation">,</span> oldEndIdx<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>idxInOld<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 没有 key 标识，当成新节点，进行创建</span>
        <span class="token function">createElm</span><span class="token punctuation">(</span>
          newStartVnode<span class="token punctuation">,</span>
          insertedVnodeQueue<span class="token punctuation">,</span>
          parentElm<span class="token punctuation">,</span>
          oldStartVnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span>
          <span class="token boolean">false</span><span class="token punctuation">,</span>
          newCh<span class="token punctuation">,</span>
          newStartIdx
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 通过 key 找到可以复用的节点</span>
        vnodeToMove <span class="token operator">=</span> oldCh<span class="token punctuation">[</span>idxInOld<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>vnodeToMove<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">patchVnode</span><span class="token punctuation">(</span>
            vnodeToMove<span class="token punctuation">,</span>
            newStartVnode<span class="token punctuation">,</span>
            insertedVnodeQueue<span class="token punctuation">,</span>
            newCh<span class="token punctuation">,</span>
            newStartIdx
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// 将老节点的值设置为 undefined</span>
          oldCh<span class="token punctuation">[</span>idxInOld<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
          canMove <span class="token operator">&amp;&amp;</span>
            nodeOps<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> vnodeToMove<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>elm<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// 没有找到可以复用的节点，当成新节点，进行创建</span>
          <span class="token function">createElm</span><span class="token punctuation">(</span>
            newStartVnode<span class="token punctuation">,</span>
            insertedVnodeQueue<span class="token punctuation">,</span>
            parentElm<span class="token punctuation">,</span>
            oldStartVnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span>
            <span class="token boolean">false</span><span class="token punctuation">,</span>
            newCh<span class="token punctuation">,</span>
            newStartIdx
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 如果老节点首尾指针交叉了，代表老节点都遍历完成了。</span>
  <span class="token comment">// 新节点length &gt; 老节点 length</span>
  <span class="token comment">// 如果新节点没有遍历完，则直接将剩余节点插入进来。</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>oldStartIdx <span class="token operator">&gt;</span> oldEndIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    refElm <span class="token operator">=</span> <span class="token function">isUndef</span><span class="token punctuation">(</span>newCh<span class="token punctuation">[</span>newEndIdx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token punctuation">:</span> newCh<span class="token punctuation">[</span>newEndIdx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>elm<span class="token punctuation">;</span>
    <span class="token function">addVnodes</span><span class="token punctuation">(</span>
      parentElm<span class="token punctuation">,</span>
      refElm<span class="token punctuation">,</span>
      newCh<span class="token punctuation">,</span>
      newStartIdx<span class="token punctuation">,</span>
      newEndIdx<span class="token punctuation">,</span>
      insertedVnodeQueue
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>newStartIdx <span class="token operator">&gt;</span> newEndIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果新节点首尾指针交叉了，代表新节点都遍历完成了。</span>
    <span class="token comment">// 新节点length &lt; 老节点 length</span>
    <span class="token comment">// 直接删除剩下的老节点。</span>
    <span class="token function">removeVnodes</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> oldStartIdx<span class="token punctuation">,</span> oldEndIdx<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br></div></div><p>在 Vue3 中将采用另外一种核心 Diff 算法，它借鉴于 <a href="https://github.com/localvoid/ivi" target="_blank" rel="noopener noreferrer">ivi<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 和 <a href="https://github.com/infernojs/inferno" target="_blank" rel="noopener noreferrer">inferno<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>在进行 Dom Diff 算法之前，先进行预处理过程，将公共的首尾提取出来。</p> <ul><li>队首比较<code>oldChild[first] = newChild[first]</code>。
<ul><li>如果一致则，指针指向下一节点。</li> <li>如果不一致，则执行 vue2 的双端比较。</li></ul></li> <li>队尾比较<code>oldChild[last] = newChild[last]</code>。
<ul><li>如果一致则，指针指向下一节点。</li> <li>如果不一致，则执行 vue2 的双端比较。</li></ul></li></ul> <p>双端比较时的优化：</p> <ul><li>判断是否有节点需要移动，将需要移动的节点加入 source 数组中。</li> <li>根据 source 数组计算出一个最长递增子序列（计算出最小的移动）。</li> <li>移动 Dom 操作。</li></ul> <h2 id="_17、react-16-dom-diff-原理"><a href="#_17、react-16-dom-diff-原理" aria-hidden="true" class="header-anchor">#</a> 17、React 16 Dom Diff 原理</h2> <p>React 16 之后，将所有的 Virtual Dom 都修改成了 Fiber Dom。</p> <p>fiberNode 有几个比较重要的属性：</p> <ul><li>child，指向该节点的第一个子节点。</li> <li>return，指向当前节点的父节点。</li> <li>sibling，指向当前节点的兄弟节点。</li> <li>alternate，指向 workInprocess Tree 中相同位置的节点。</li> <li>effectTag，副作用标识，标识该节点是否存在变化。</li> <li>updateQueue，当前节点中的更新队列（例：setState 多次产生的更新）。</li></ul> <p>更新方式如下：</p> <ul><li>克隆 CurrentFiber Tree，生成 WorkInprocess Tree。
<ul><li>WorkInprocess Tree 表示即将渲染到页面上的新的状态，会在下文进行更新。</li> <li>每一个 WorkInprocess Tree 上的节点的 alternate 指向 CurrentFiber Tree 上对应的节点。</li></ul></li> <li>循环 WorkInprocess Tree。
<ul><li>根据根节点的 child 深度优先向下遍历。</li></ul></li> <li>每找到一个节点，创建 update 对象，并 push 到 fiberNode 节点 updateQueue 属性上。</li> <li>执行 processUpdateQueue 方法，生成新 state。</li> <li>比较 newState 和 oldState。
<ul><li>一致，则跳过。</li> <li>不一致，则打上 effectTag = Update 的标识。</li> <li>每一个 effectTag 都代表一次 dom 操作，常见的有，Update，Delete 等</li></ul></li> <li>遍历完毕。
<ul><li>将所有打上 effectTag 标识的节点组成一个 effect list 链表。</li> <li>循环该链表，执行对应的 Dom 操作。</li></ul></li> <li>将 WorkInprocess Tree 和 CurrentFiber Tree 进行交换。
<ul><li>即当前的 CurrentFiber Tree 变为更新后的状态树。</li></ul></li></ul> <h2 id="_18、redux-中间件处理原理"><a href="#_18、redux-中间件处理原理" aria-hidden="true" class="header-anchor">#</a> 18、Redux 中间件处理原理</h2> <p>Redux 中的中间件其实是用柯里化函数编写而成的，例如 logger 中间件：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// logger 中间件</span>
<span class="token keyword">const</span> <span class="token function-variable function">loggerMiddle</span> <span class="token operator">=</span> <span class="token parameter">store</span> <span class="token operator">=&gt;</span> <span class="token parameter">next</span> <span class="token operator">=&gt;</span> <span class="token parameter">action</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'old state'</span><span class="token punctuation">,</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">next</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'next state'</span><span class="token punctuation">,</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>接下来我们分析一下中间件的处理过程：</p> <ul><li>执行 applyMiddleware([loggerMiddle]) 方法生成一个中间件执行函数 fn。</li> <li>将 fn 作为 creteStore 中的第三个参数进行传入。</li> <li>creteStore 中的第三个参数如果存在，会进行 creteStore 覆盖的操作。
<ul><li>将 oldCreateStore 方法传入 fn 中，进行缓存，生成执行函数 fn1。</li> <li>在 fn1 中执行接收 oldCreateStore 的参数，创建 oldStore。</li> <li>将中间件集合通过 compose 函数，组合成一个新函数 fn3。</li> <li>将老的 dispatch 传入 fn3，生成一个新的 dispatch。</li> <li>用新的 dispatch 代替旧的 dispatch，<strong>实际上中间件就是对 dispatch 的增强</strong>。</li> <li>这样在执行新 dispatch 时，就会一次触发执行中间件的操作。</li></ul></li></ul> <p>Redux 中间件的执行顺序和 koa 很像，都是洋葱式执行顺序。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">applyMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// aStart -- bStart -- cStart -- cEnd -- bEnd -- aEnd。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="_19、nodejs-中-setimmediate-和-settimeout-的执行顺序"><a href="#_19、nodejs-中-setimmediate-和-settimeout-的执行顺序" aria-hidden="true" class="header-anchor">#</a> 19、Nodejs 中 setImmediate 和 setTimeout 的执行顺序</h2> <p>首先我们得知道 nodejs 的异步调度机制，<a href="/blog/library-node">链接</a></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setImmediate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>这道题没有正确答案，顺序有时候一致，有时候不一致。</p> <p>1、首先要明白一点，在 nodejs 中 setTimeout(fn,0) 相当于 setTimeout(fn,1)。</p> <p>2、在 nodejs 异步回调中，首先进入 timers 阶段，如果机器性能不好，进入该阶段时 1ms 已经过去了，那么 setTimeout 会首先执行。</p> <p>3、如果机器性能好，进入 timers 阶段时，setTimeOut 还在等待 1ms ，这时会执行后面的阶段，当执行到 check 阶段时，会执行 setImmediate。</p> <p>4、在下一个事件循环周期中，执行 setTimeout。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>__filename<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timeout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'immediate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>这个题的答案就明确了。</p> <p>1、首先，在 poll 阶段执行 raedFile 函数，执行完成之后 setTimeout 和，setImmediate 都被加入到了对应的阶段。</p> <p>2、poll 阶段执行完毕，由于没有其他的 io 操作，并且有设置 setImmediate，所以首先执行 setImmediate 方法。</p> <p>4、在下一个事件循环周期中，执行 setTimeout。</p> <p>综上所述：</p> <ul><li>如果两者都在主模块中调用，那么执行先后取决于进程性能，也就是随机。</li> <li>如果两者都不在主模块调用（被一个异步操作包裹），那么 setImmediate 的回调永远先执行。</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/yhlben/blog/edit/master/docs/interview/framework.md" target="_blank" rel="noopener noreferrer">本文源码地址</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">更新时间: </span> <span class="time">8/23/2019, 7:02:28 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/interview/html.html" class="prev">
          HTML 面试题
        </a></span> <span class="next"><a href="/interview/base.html">
          基础面试题
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.608a412e.js" defer></script><script src="/assets/js/2.9c2b7429.js" defer></script><script src="/assets/js/93.2f8e5ff5.js" defer></script>
  </body>
</html>
